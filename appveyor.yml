branches:
  only:
  - master

version: '0.1.0.{build}'

environment:
  matrix:
    - PYTHON: "C:\\Miniconda35-x64\\Scripts\\activate.bat"
    - PYTHON: "C:\\Miniconda36-x64\\Scripts\\activate.bat"

platform:
  - x64

configuration:
  - Release

install:
  - cmd: call %PYTHON%
  - cmd: conda config --set always_yes yes --set changeps1 no
  - cmd: conda update -q conda
  - cmd: conda config --add channels conda-forge
  - cmd: conda install -c conda-forge pvl protobuf gdal numpy pandas sqlalchemy pyyaml networkx

build_script:
  - cmd: conda build .
  - cmd: conda install --use-local plio

test_script:
  - cmd: pytest --cov=plio

on_success:
  - cmd: conda config --set anaconda_upload yes
  - cmd: conda build --token %CONDA_UPLOAD_TOKEN% .
